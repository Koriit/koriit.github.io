<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Lista płyt CD</title>
    <meta name="robots" content="noindex">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
    <h1 class="mb-3">Lista płyt CD</h1>
    <p>Ta strona zawiera listę albumów, które chciałbym mieć. Nie jest nigdzie linkowana, więc proszę zachować adres w zakładkach.</p>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Lp.</th>
            <th>Zespół</th>
            <th>Album</th>
            <th>Posiadam?</th>
        </tr>
        </thead>
        <tbody id="album-table-body"></tbody>
    </table>
</div>
<script src="albums.js"></script>
<script>

const urlParams = new URLSearchParams(window.location.search);
const isAdmin = urlParams.has('admin');
let tbody;

function updateRanks() {
  albums.forEach((a, i) => a.rank = i + 1);
}

function renderTable() {
  tbody.innerHTML = '';
  updateRanks();
  albums.forEach((album, idx) => {
    const tr = document.createElement('tr');
    if (isAdmin) {
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${album.band}</td>
        <td><img src="${album.thumb}" alt="miniaturka" class="img-thumbnail me-2" style="width:50px;height:50px;">${album.album}</td>
        <td><input type="checkbox" class="owned-checkbox" data-index="${idx}" ${album.owned ? 'checked' : ''}></td>
        <td>
          <button class="btn btn-sm btn-secondary move-up" data-index="${idx}">&#8593;</button>
          <button class="btn btn-sm btn-secondary move-down" data-index="${idx}">&#8595;</button>
        </td>
      `;
    } else {
      const ownedText = album.owned ? 'Tak' : 'Nie';
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${album.band}</td>
        <td><img src="${album.thumb}" alt="miniaturka" class="img-thumbnail me-2" style="width:50px;height:50px;">${album.album}</td>
        <td>${ownedText}</td>
      `;
    }
    tbody.appendChild(tr);
  });
}

window.addEventListener('DOMContentLoaded', () => {
  tbody = document.getElementById('album-table-body');
  const headerRow = document.querySelector('thead tr');
  if (isAdmin) {
    const th = document.createElement('th');
    th.textContent = 'Akcje';
    headerRow.appendChild(th);
  }
  renderTable();

  if (isAdmin) {
    tbody.addEventListener('click', e => {
      const index = parseInt(e.target.dataset.index);
      if (e.target.classList.contains('move-up') && index > 0) {
        [albums[index - 1], albums[index]] = [albums[index], albums[index - 1]];
        renderTable();
      } else if (e.target.classList.contains('move-down') && index < albums.length - 1) {
        [albums[index + 1], albums[index]] = [albums[index], albums[index + 1]];
        renderTable();
      }
    });

    tbody.addEventListener('change', e => {
      if (e.target.classList.contains('owned-checkbox')) {
        const index = parseInt(e.target.dataset.index);
        albums[index].owned = e.target.checked;
      }
    });

    const container = document.querySelector('.container');
    const exportBtn = document.createElement('button');
    exportBtn.className = 'btn btn-primary mt-3';
    exportBtn.textContent = 'Export JSON';
    container.appendChild(exportBtn);

    const textarea = document.createElement('textarea');
    textarea.className = 'form-control mt-2';
    textarea.style.display = 'none';
    container.appendChild(textarea);

    exportBtn.addEventListener('click', () => {
      textarea.style.display = 'block';
      textarea.value = JSON.stringify(albums, null, 2);
    });
  }
});
</script>
</body>
</html>
